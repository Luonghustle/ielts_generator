<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Reading HTML Generator</title>
    <style>
        :root {
            --bg: #0f172a;
            --panel: #111827;
            --accent: #38bdf8;
            --muted: #cbd5e1;
            --border: #1f2937;
            --success: #22c55e;
            --error: #f87171;
        }
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
            background: radial-gradient(circle at 20% 20%, rgba(56, 189, 248, 0.08), transparent 25%), var(--bg);
            color: #e2e8f0;
        }
        header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(6px);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        header h1 {
            margin: 0;
            font-size: 20px;
            letter-spacing: 0.3px;
        }
        main {
            padding: 24px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 16px;
        }
        .card {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25);
        }
        .card h2 {
            margin-top: 0;
            font-size: 16px;
            letter-spacing: 0.2px;
        }
        textarea {
            width: 100%;
            min-height: 260px;
            background: #0b1220;
            color: #e2e8f0;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px;
            font-family: "Fira Code", "Consolas", monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
        }
        button {
            background: linear-gradient(135deg, #38bdf8, #60a5fa);
            color: #0b1220;
            border: none;
            padding: 10px 14px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.08s ease, box-shadow 0.2s ease;
        }
        button:hover { transform: translateY(-1px); box-shadow: 0 10px 30px rgba(56, 189, 248, 0.3); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .stack { display: flex; flex-direction: column; gap: 10px; }
        .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border-radius: 999px;
            background: #0b1220;
            border: 1px solid var(--border);
            color: var(--muted);
            font-size: 13px;
        }
        .status {
            margin: 0;
            font-size: 13px;
            color: var(--muted);
        }
        .status.success { color: var(--success); }
        .status.error { color: var(--error); }
        .link {
            color: var(--accent);
            text-decoration: none;
            font-weight: 600;
        }
        iframe {
            width: 100%;
            border: 1px solid var(--border);
            border-radius: 10px;
            min-height: 220px;
            background: #ffffff;
        }
    </style>
</head>
<body>
    <header>
        <h1>IELTS Reading HTML Generator</h1>
        <div class="pill">Local/offline - uses template/base-reading.html</div>
    </header>
    <main>
        <section class="card stack">
            <h2>1) Paste or load JSON</h2>
            <textarea id="json-input" spellcheck="false" placeholder="Paste your JSON here..."></textarea>
            <div class="row">
                <input type="file" id="file-input" accept=".json">
                <button id="load-sample">Load sample</button>
                <span class="status" id="json-status"></span>
            </div>
        </section>

        <section class="card stack">
            <h2>2) Generate HTML</h2>
            <div class="row">
                <input type="file" id="template-input" accept=".html">
                <span class="status" id="template-hint">If file:// blocks fetch, pick template/base-reading.html here.</span>
            </div>
            <div class="row">
                <button id="generate-btn">Generate file</button>
                <span class="status" id="template-status">Template: loading...</span>
            </div>
            <p class="status" id="result-status"></p>
            <div class="row" id="download-row" style="display:none;">
                <a id="download-link" class="link" download>Download generated file</a>
            </div>
            <iframe id="preview-frame" title="Preview" hidden></iframe>
        </section>

        <section class="card stack">
            <h2>JSON tips</h2>
            <ul style="margin: 0 0 0 16px; color: var(--muted); line-height: 1.6;">
                <li>Keep question numbers unique and sequential across all parts.</li>
                <li>Use <code>{{number}}</code> placeholders inside summaries to create blanks.</li>
                <li><strong>Supported types</strong>: TFNG, YNNG, MCQ, MATCH_OPTIONS, MATCH_HEADINGS, SUMMARY_COMPLETION, SUMMARY_COMPLETION_BOX, SENTENCE_COMPLETION.</li>
                <li>Put your JSON files in <code>data/</code> to keep things tidy.</li>
            </ul>
        </section>
    </main>

    <script src="scripts/generator.js"></script>
    <script>
        (function() {
            const jsonInput = document.getElementById('json-input');
            const fileInput = document.getElementById('file-input');
            const generateBtn = document.getElementById('generate-btn');
            const loadSampleBtn = document.getElementById('load-sample');
            const resultStatus = document.getElementById('result-status');
            const templateStatus = document.getElementById('template-status');
            const templateInput = document.getElementById('template-input');
            const jsonStatus = document.getElementById('json-status');
            const downloadLink = document.getElementById('download-link');
            const downloadRow = document.getElementById('download-row');
            const previewFrame = document.getElementById('preview-frame');

            const inlineSampleData = {
                "test_id": "sample-reading-01",
                "title": "IELTS Reading Sample - Generator Demo",
                "parts": [
                    {
                        "part": 1,
                        "name": "Part 1",
                        "instructions": "Read the text and answer questions 1-5.",
                        "passage": {
                            "title": "City Parks Comeback",
                            "paragraphs": [
                                "After years of budget cuts, the local council asked residents what they wanted from their green spaces. The answers were surprisingly consistent: shade, space to move, and somewhere that felt safe. By the time the first park reopened, benches faced the playground instead of the parking lot, and new lighting made evening walks possible.",
                                "A small team of volunteers kept the gardens watered during the first dry summer. Among them was Liem, a retired engineer who had campaigned to replace concrete with native grasses. He argued that plants adapted to the climate would thrive without constant irrigation."
                            ]
                        },
                        "question_groups": [
                            {
                                "type": "TFNG",
                                "instructions": "<p><strong>Questions 1-3</strong><br>Do the following statements agree with the information given in Reading Passage 1?</p><p>In boxes 1-3 on your answer sheet, write TRUE, FALSE or NOT GIVEN.</p>",
                                "questions": [
                                    {
                                        "number": 1,
                                        "statement": "Residents wanted the benches to stay next to the car park.",
                                        "answer": "FALSE"
                                    },
                                    {
                                        "number": 2,
                                        "statement": "New lighting allowed people to use the park later in the day.",
                                        "answer": "TRUE"
                                    },
                                    {
                                        "number": 3,
                                        "statement": "The council planted exotic flowers to attract more visitors.",
                                        "answer": "NOT GIVEN"
                                    }
                                ]
                            },
                            {
                                "type": "MATCH_OPTIONS",
                                "instructions": "<p><strong>Questions 4-5</strong><br>Match each person with their contribution.</p><p>Choose the correct letter A-C.</p>",
                                "options_title": "List of People",
                                "options": [
                                    { "label": "A", "text": "Mai, landscape student" },
                                    { "label": "B", "text": "Liem, retired engineer" },
                                    { "label": "C", "text": "An, lighting contractor" }
                                ],
                                "questions": [
                                    {
                                        "number": 4,
                                        "prompt": "proposed using drought-resistant plants",
                                        "answer": "B"
                                    },
                                    {
                                        "number": 5,
                                        "prompt": "designed a safer layout for footpaths",
                                        "answer": "A"
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        "part": 2,
                        "name": "Part 2",
                        "instructions": "Read the text and answer questions 6-9.",
                        "passage": {
                            "title": "Rooftop Harvests",
                            "paragraphs": [
                                "<strong>A</strong>  Small rooftop farms now cover the older apartment blocks near the river. Residents swap seeds, compare soil mixes and share water barrels. The goal is not profit but resilience: fresh herbs and vegetables when supply chains stumble.",
                                "<strong>B</strong>  The roofs also collect data. Moisture sensors report to a simple dashboard, letting growers see when a crop needs more shade cloth or irrigation. The arrangement convinced sceptical building owners that plants would not damage their roofs."
                            ]
                        },
                        "question_groups": [
                            {
                                "type": "MATCH_HEADINGS",
                                "instructions": "<p><strong>Questions 6-7</strong><br>Choose the correct heading for paragraphs A-B from the list below.</p>",
                                "options_title": "List of Headings",
                                "options_list_style": "lower-roman",
                                "options": [
                                    { "label": "i", "text": "Sharing tools and knowledge" },
                                    { "label": "ii", "text": "Monitoring moisture with technology" },
                                    { "label": "iii", "text": "Protecting old roofs from heavy rain" }
                                ],
                                "questions": [
                                    { "number": 6, "prompt": "Paragraph A", "answer": "i" },
                                    { "number": 7, "prompt": "Paragraph B", "answer": "ii" }
                                ]
                            },
                            {
                                "type": "SUMMARY_COMPLETION",
                                "instructions": "<p><strong>Questions 8-9</strong><br>Complete the summary below using NO MORE THAN TWO WORDS for each answer.</p>",
                                "paragraphs": [
                                    "The pilot garden replaced {{8}} parking spots and added {{9}} small ponds."
                                ],
                                "answers": [
                                    { "number": 8, "answer": "thirty" },
                                    { "number": 9, "answer": ["two", "2"] }
                                ]
                            }
                        ]
                    },
                    {
                        "part": 3,
                        "name": "Part 3",
                        "instructions": "Read the text and answer questions 10-14.",
                        "passage": {
                            "title": "Future of Work",
                            "paragraphs": [
                                "When office workers stayed home during the pandemic, many teams discovered that productivity did not collapse. Some leaders worried that culture would fade, but weekly check-ins and deliberate mentoring filled part of the gap.",
                                "Now companies are mixing approaches. New graduates often want time in the office to learn informally, while experienced staff ask for flexible schedules. The most successful experiments blend quiet focus days with structured collaboration."
                            ]
                        },
                        "question_groups": [
                            {
                                "type": "YNNG",
                                "instructions": "<p><strong>Questions 10-11</strong><br>Do the following statements agree with the views of the writer in Reading Passage 3?</p>",
                                "questions": [
                                    {
                                        "number": 10,
                                        "statement": "Team output fell sharply when employees first stayed home.",
                                        "answer": "NO"
                                    },
                                    {
                                        "number": 11,
                                        "statement": "Some mentoring continued even without a physical office.",
                                        "answer": "YES"
                                    }
                                ]
                            },
                            {
                                "type": "MCQ",
                                "instructions": "<p><strong>Question 12</strong><br>Choose the correct letter, A, B, C or D.</p>",
                                "questions": [
                                    {
                                        "number": 12,
                                        "question_text": "What do many new graduates want from office time?",
                                        "options": [
                                            { "label": "A", "text": "quieter schedules" },
                                            { "label": "B", "text": "informal learning" },
                                            { "label": "C", "text": "strict supervision" },
                                            { "label": "D", "text": "shorter weeks" }
                                        ],
                                        "answer": "B"
                                    }
                                ]
                            },
                            {
                                "type": "SUMMARY_COMPLETION_BOX",
                                "instructions": "<p><strong>Questions 13-14</strong><br>Choose TWO words from the box to complete the sentences.</p>",
                                "word_bank": ["remote", "coaching", "automation", "coworking"],
                                "paragraphs": [
                                    "Some teams shifted to {{13}} days while others met in {{14}} hubs."
                                ],
                                "answers": [
                                    { "number": 13, "answer": "remote" },
                                    { "number": 14, "answer": "coworking" }
                                ],
                                "dnd_group": "summary-3"
                            }
                        ]
                    }
                ]
            };

            let templateHtml = '';

            const setStatus = (el, message, tone = 'info') => {
                el.textContent = message;
                el.classList.remove('success', 'error');
                if (tone === 'success') el.classList.add('success');
                if (tone === 'error') el.classList.add('error');
            };

            async function loadTemplate() {
                try {
                    const res = await fetch('template/base-reading.html', { cache: 'no-store' });
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    templateHtml = await res.text();
                    setStatus(templateStatus, 'Template ready (template/base-reading.html)', 'success');
                } catch (err) {
                    setStatus(templateStatus, 'Could not fetch template. If you opened file://, choose base-reading.html below.', 'error');
                }
            }

            async function loadSample() {
                try {
                    const res = await fetch('data/sample-reading.json');
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    const data = await res.json();
                    jsonInput.value = JSON.stringify(data, null, 2);
                    setStatus(jsonStatus, 'Loaded sample-reading.json', 'success');
                } catch (err) {
                    jsonInput.value = JSON.stringify(inlineSampleData, null, 2);
                    setStatus(jsonStatus, 'Loaded built-in sample (fetch blocked on file://).', 'success');
                }
            }

            function handleFile(event) {
                const file = event.target.files?.[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = () => {
                    jsonInput.value = reader.result;
                    setStatus(jsonStatus, `Loaded ${file.name}`, 'success');
                };
                reader.onerror = () => setStatus(jsonStatus, 'Could not read file.', 'error');
                reader.readAsText(file);
            }

            function handleTemplateFile(event) {
                const file = event.target.files?.[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = () => {
                    templateHtml = reader.result;
                    setStatus(templateStatus, `Template loaded from ${file.name}`, 'success');
                };
                reader.onerror = () => setStatus(templateStatus, 'Could not read template file.', 'error');
                reader.readAsText(file);
            }

            function generateHtml() {
                if (!templateHtml) {
                    setStatus(resultStatus, 'Template not loaded yet.', 'error');
                    return;
                }
                try {
                    const data = JSON.parse(jsonInput.value);
                    const { html } = window.IeltsGenerator.renderFromJson(data, templateHtml);
                    const blob = new Blob([html], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    downloadLink.href = url;
                    downloadLink.download = `${data.test_id || 'reading-output'}.html`;
                    downloadRow.style.display = 'flex';
                    previewFrame.hidden = false;
                    previewFrame.src = url;
                    setStatus(resultStatus, `Generated ${data.test_id || 'reading-output'}.html`, 'success');
                } catch (err) {
                    setStatus(resultStatus, err.message || 'Failed to generate file.', 'error');
                }
            }

            fileInput.addEventListener('change', handleFile);
            loadSampleBtn.addEventListener('click', loadSample);
            templateInput.addEventListener('change', handleTemplateFile);
            generateBtn.addEventListener('click', generateHtml);
            loadTemplate();
        })();
    </script>
</body>
</html>




